<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form Data Penduduk - Puskesmas</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Flatpickr -->
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #dbeafe 0%, #f0fdfa 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
        max-width: 900px;
      }

      .card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        padding: 1.5rem;
        color: #fff;
      }

      .card h5 {
        font-size: 1.1rem;
      }

      .form-label {
        font-weight: 600;
        color: #374151;
      }

      input.form-control,
      select.form-select,
      textarea.form-control {
        border-radius: 12px;
        transition: all 0.2s;
      }

      input.form-control:focus,
      select.form-select:focus,
      textarea.form-control:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
      }

      .btn {
        border-radius: 12px;
        font-weight: 600;
      }

      footer {
        margin-top: auto;
        text-align: center;
        padding: 1rem;
        color: #111827;
        font-size: 0.9rem;
      }

      .nav-pills {
        flex-wrap: wrap;
      }

      .nav-pills .nav-link {
        font-weight: 600;
        color: #0f172a;
        border-radius: 10px;
        margin: 0.25rem;
        white-space: nowrap;
      }

      .nav-pills .nav-link.active {
        background-color: #16a34a !important;
        color: #fff !important;
      }

      #kematian .card {
        background: linear-gradient(135deg, #22c55e, #14b8a6);
      }

      #kelahiran .card {
        background: linear-gradient(135deg, #475569, #65a30d);
      }

      /* Tombol printer */
      .btn-print {
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #198754;
        color: white;
        font-size: 1.2rem;
        border: none;
        transition: all 0.2s;
      }

      .btn-print:hover {
        background-color: #157347;
        transform: scale(1.05);
      }

      /* Responsif */
      @media (max-width: 768px) {
        .btn {
          width: 100%;
        }

        .btn-print {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }

        .nav-pills .nav-link {
          flex: 1 1 auto;
          text-align: center;
        }
      }
      .input-group-text {
        border-radius: 0 12px 12px 0;
        border-left: none;
      }
      .input-group .form-control {
        border-radius: 12px 0 0 12px;
      }
    </style>
  </head>

  <body>
    <div class="container py-4">
      <div class="text-center mb-3">
        <img
          src="https://pkmtrenggalek.github.io/SIP/assets/pkm.png"
          alt="Logo Puskesmas"
          width="80"
          class="mb-2"
        />
        <h5 class="fw-bold text-success">Form Data Penduduk</h5>
      </div>

      <div class="d-flex justify-content-end mb-3">
        <a href="laporan.html" class="btn-print shadow-sm">
          <i class="fa-solid fa-print"></i>
        </a>
      </div>

      <ul class="nav nav-pills justify-content-center mb-4" id="dataTabs">
        <li class="nav-item">
          <button
            class="nav-link active"
            id="kematian-tab"
            data-bs-toggle="tab"
            data-bs-target="#kematian"
            type="button"
          >
            ðŸª¦ Input Kematian
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            id="kelahiran-tab"
            data-bs-toggle="tab"
            data-bs-target="#kelahiran"
            type="button"
          >
            ðŸ‘¶ Input Kelahiran
          </button>
        </li>
      </ul>

      <div class="tab-content">
        <!-- FORM KEMATIAN -->
        <div class="tab-pane fade show active" id="kematian">
          <div class="card">
            <h5 class="mb-3 fw-semibold">
              <i class="fa-solid fa-tombstone me-2"></i>Data Kematian
            </h5>

            <form id="formKematian">
              <div class="grid-2col">
                <div>
                  <label for="nik" class="form-label">NIK *</label>
                  <input
                    type="text"
                    id="nik"
                    class="form-control"
                    maxlength="16"
                    required
                  />
                </div>

                <div>
                  <label for="nama" class="form-label">Nama Lengkap *</label>
                  <input type="text" id="nama" class="form-control" required />
                </div>

                <div>
                  <label class="form-label">Desa / Kelurahan *</label>
                  <select class="form-select" id="desa" required>
                    <option value="">--Pilih--</option>
                    <option>Ngantru</option>
                    <option>Tamanan</option>
                    <option>Sumber Gedong</option>
                    <option>Kelutan</option>
                    <option>Sambirejo</option>
                    <option>Karangsoko</option>
                  </select>
                </div>

                <div>
                  <label class="form-label">Umur *</label>
                  <input
                    type="number"
                    id="umur"
                    class="form-control"
                    min="0"
                    max="120"
                    required
                  />
                </div>

                <div>
                  <label class="form-label">Jenis Kelamin *</label>
                  <select id="jk" class="form-select" required>
                    <option value="">-- Pilih --</option>
                    <option value="L">Laki-laki</option>
                    <option value="P">Perempuan</option>
                  </select>
                </div>

                <div>
                  <label class="form-label">Tanggal Meninggal *</label>
                  <input
                    type="date"
                    id="tgl_meninggal"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-span-2">
                  <label for="alamat_lengkap" class="form-label"
                    >Alamat Lengkap *</label
                  >
                  <textarea
                    id="alamat_lengkap"
                    class="form-control"
                    rows="2"
                    required
                  ></textarea>
                </div>

                <div>
                  <label class="form-label">Tempat Meninggal *</label>
                  <input
                    type="text"
                    id="tempat_meninggal"
                    class="form-control"
                    placeholder="Misal: RSUD Trenggalek"
                    required
                  />
                </div>

                <div>
                  <label class="form-label">Penyebab Kematian *</label>
                  <textarea
                    id="diagnosa"
                    class="form-control"
                    rows="2"
                    required
                  ></textarea>
                </div>
              </div>

              <div class="text-end mt-3">
                <button
                  type="submit"
                  class="btn btn-light text-success fw-bold shadow-sm"
                >
                  <i class="fa-solid fa-paper-plane me-1"></i> Simpan Data
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- FORM KELAHIRAN -->
        <div class="tab-pane fade" id="kelahiran">
          <div class="card">
            <h5 class="mb-3 fw-semibold">
              <i class="fa-solid fa-baby me-2"></i>Data Kelahiran
            </h5>

            <form id="formKelahiran">
              <div class="grid-2col">
                <div>
                  <label class="form-label text-white">NIK Bayi *</label>
                  <input
                    type="text"
                    id="nik_bayi"
                    class="form-control"
                    maxlength="16"
                    required
                  />
                </div>
                <div>
                  <label class="form-label text-white">Nama Bayi *</label>
                  <input
                    type="text"
                    id="nama_bayi"
                    class="form-control"
                    required
                  />
                </div>
                <div>
                  <label class="form-label text-white">Jenis Kelamin *</label>
                  <select id="jk_bayi" class="form-select" required>
                    <option value="">-- Pilih --</option>
                    <option value="L">Laki-laki</option>
                    <option value="P">Perempuan</option>
                  </select>
                </div>
                <div>
                  <label class="form-label text-white">Nama Ayah *</label>
                  <input
                    type="text"
                    id="nama_ayah"
                    class="form-control"
                    required
                  />
                </div>
                <div>
                  <label class="form-label text-white">Nama Ibu *</label>
                  <input
                    type="text"
                    id="nama_ibu"
                    class="form-control"
                    required
                  />
                </div>
                <div>
                  <label class="form-label text-white">RT / RW *</label>
                  <div class="d-flex gap-2">
                    <input
                      type="text"
                      id="RT"
                      class="form-control text-center"
                      required
                    />
                    <input
                      type="text"
                      id="RW"
                      class="form-control text-center"
                      required
                    />
                  </div>
                </div>
                <div class="col-span-2">
                  <label class="form-label text-white">Alamat *</label>
                  <textarea
                    id="alamat"
                    class="form-control"
                    rows="2"
                    required
                  ></textarea>
                </div>
                <div>
                  <label class="form-label text-white"
                    >Tanggal / Jam Lahir *</label
                  >
                  <div class="d-flex gap-2">
                    <input
                      type="date"
                      id="tgl_lahir"
                      class="form-control"
                      required
                    />
                    <div class="input-group">
                      <input
                        type="text"
                        id="jam_lahir"
                        class="form-control"
                        placeholder="Pilih jam"
                        required
                      />
                      <span class="input-group-text bg-white">
                        <i class="fa-regular fa-clock text-success"></i>
                      </span>
                    </div>
                  </div>
                </div>
                <div>
                  <label class="form-label text-white"
                    >Jenis Persalinan *</label
                  >
                  <select class="form-select" id="jenis" required>
                    <option value="">-- Pilih --</option>
                    <option>Normal</option>
                    <option>Spontan</option>
                    <option>SC</option>
                    <option>Drip</option>
                    <option>Vacum</option>
                  </select>
                </div>
                <div>
                  <label class="form-label text-white">Tempat Lahir *</label>
                  <select class="form-select" id="tempat_lahir" required>
                    <option value="">-- Pilih --</option>
                    <option>POLINDES</option>
                    <option>BPM</option>
                    <option>Puskesmas</option>
                    <option>PONED</option>
                    <option>RSUD</option>
                    <option>BPS</option>
                    <option>Lainnya</option>
                  </select>
                </div>
                <div>
                  <label class="form-label text-white"
                    >Penolong Kelahiran *</label
                  >
                  <select class="form-select" id="penolong" required>
                    <option value="">-- Pilih --</option>
                    <option>Bidan</option>
                    <option>SPOG</option>
                    <option>Lainnya</option>
                  </select>
                </div>
                <div>
                  <label class="form-label text-white">Jenis Pendanaan *</label>
                  <select class="form-select" id="jenis_pendanaan" required>
                    <option value="">-- Pilih --</option>
                    <option>KIS</option>
                    <option>BPJS</option>
                    <option>Bayar</option>
                    <option>Jampersal</option>
                    <option>Lainnya</option>
                  </select>
                </div>
                <div>
                  <label class="form-label text-white"
                    >Berat & Tinggi Badan</label
                  >
                  <div class="d-flex gap-2">
                    <input
                      type="number"
                      step="0.1"
                      id="BB"
                      placeholder="BB (kg)"
                      class="form-control text-center"
                    />
                    <input
                      type="number"
                      step="0.1"
                      id="TB"
                      placeholder="TB (cm)"
                      class="form-control text-center"
                    />
                  </div>
                </div>
              </div>

              <div class="text-end mt-3">
                <button
                  type="submit"
                  class="btn btn-light text-success fw-bold shadow-sm"
                >
                  <i class="fa-solid fa-paper-plane me-1"></i> Simpan Data
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer>Â© Sistem Data Penduduk Puskesmas Trenggalek | @yoga</footer>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        flatpickr("#tgl_meninggal", { dateFormat: "Y-m-d" });
        flatpickr("#tgl_lahir", { dateFormat: "Y-m-d" });

        // Time picker (24 jam)
        flatpickr("#jam_lahir", {
          enableTime: true,
          noCalendar: true,
          dateFormat: "H:i",
          time_24hr: true,
          minuteIncrement: 1,
        });
        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbwyu-78yUjES6fnZyi6nClaRjOmmqkUxhY9ZXsz9Xsa1D6pYkymHl6U1QfUXMnD7_dvwA/exec";

        // === FORM KEMATIAN ===
        document
          .getElementById("formKematian")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Mengirim Data Kematian...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKematian",
              nik: nik.value,
              nama: nama.value,
              alamat_lengkap: alamat_lengkap.value,
              desa: desa.value,
              umur: umur.value,
              jk: jk.value,
              tgl_meninggal: tgl_meninggal.value,
              tempat_meninggal: tempat_meninggal.value,
              diagnosa: diagnosa.value,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload), // tanpa headers agar tidak preflight
              });
              const data = await res.json();
              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kematian tersimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                formKematian.reset();
              } else throw new Error(data.message);
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });

        // === FORM KELAHIRAN ===
        document
          .getElementById("formKelahiran")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const nik_bayi = document.getElementById("nik_bayi").value.trim();
            const nama_bayi = document.getElementById("nama_bayi").value.trim();
            const jk_bayi = document.getElementById("jk_bayi").value;
            const nama_ayah = document.getElementById("nama_ayah").value.trim();
            const nama_ibu = document.getElementById("nama_ibu").value.trim();
            const alamat = document.getElementById("alamat").value.trim();
            const RT = document.getElementById("RT").value.trim();
            const RW = document.getElementById("RW").value.trim();
            const desa = document.getElementById("desa").value;
            const tgl_lahir = document.getElementById("tgl_lahir").value;
            const jam_lahir = document.getElementById("jam_lahir").value.trim();
            const jenis = document.getElementById("jenis").value;
            const tempat_lahir = document.getElementById("tempat_lahir").value;
            const penolong =
              document.querySelector("select#penolong")?.value || "";
            const jenis_pendanaan =
              document.querySelector("select#jenis_pendanaan")?.value || "";
            const BB = document.getElementById("BB").value.trim();
            const TB = document.getElementById("TB").value.trim();

            if (!nik_bayi || !nama_bayi || !tgl_lahir || !jk_bayi) {
              Swal.fire(
                "Lengkapi Data!",
                "Beberapa field penting masih kosong.",
                "warning"
              );
              return;
            }

            Swal.fire({
              title: "Mengirim Data Kelahiran...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKelahiran",
              nik_bayi,
              nama_bayi,
              jk_bayi,
              nama_ayah,
              nama_ibu,
              alamat,
              RT,
              RW,
              desa,
              tgl_lahir,
              jam_lahir,
              jenis,
              tempat_lahir,
              penolong,
              jenis_pendanaan,
              BB,
              TB,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload),
              });
              const data = await res.json();

              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kelahiran berhasil disimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                e.target.reset();
              } else throw new Error(data.message || "Gagal menyimpan data!");
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });
      });
    </script>
  </body>
</html>
