<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form Data Penduduk - Puskesmas</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Flatpickr -->
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #dbeafe 0%, #f0fdfa 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        background: linear-gradient(135deg, #22c55e, #14b8a6);
        color: #fff;
        padding: 2rem;
      }
      .form-label {
        font-weight: 600;
        color: #374151;
      }
      input.form-control,
      select.form-select,
      textarea.form-control {
        border-radius: 12px;
        transition: all 0.2s;
      }
      input.form-control:focus,
      select.form-select:focus,
      textarea.form-control:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
      }
      .btn-primary,
      .btn-light {
        border-radius: 12px;
        padding: 0.55rem 1.5rem;
        font-weight: 600;
      }
      footer {
        margin-top: auto;
        text-align: center;
        padding: 1rem;
        color: #111827;
        font-size: 0.9rem;
      }
      .nav-pills .nav-link.active {
        background-color: #16a34a !important;
      }
      .nav-pills .nav-link {
        font-weight: 600;
        color: #0f172a;
      }
    </style>
  </head>

  <body>
    <div class="container py-5">
      <h3 class="mb-4 text-center fw-bold">
        <i class="fa-solid fa-users me-2 text-success"></i>Form Data Penduduk
      </h3>
      <a
        href="index.html"
        class="btn btn-outline-success btn-sm px-4 shadow-sm"
      >
        Laporan
      </a>
      <!-- Tabs menu -->
      <ul class="nav nav-pills justify-content-center mb-4" id="dataTabs">
        <li class="nav-item">
          <button
            class="nav-link active"
            id="kematian-tab"
            data-bs-toggle="tab"
            data-bs-target="#kematian"
            type="button"
          >
            ðŸª¦ Input Data Kematian
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            id="kelahiran-tab"
            data-bs-toggle="tab"
            data-bs-target="#kelahiran"
            type="button"
          >
            ðŸ‘¶ Input Data Kelahiran
          </button>
        </li>
      </ul>

      <!-- Tab content -->
      <div class="tab-content">
        <!-- === FORM KEMATIAN === -->
        <div class="tab-pane fade show active" id="kematian">
          <div class="card">
            <h5 class="mb-3 fw-semibold text-white">
              <i class="fa-solid fa-tombstone me-2"></i>Data Kematian
            </h5>

            <form id="formKematian">
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">NIK</label>
                  <input
                    type="text"
                    id="nik"
                    class="form-control"
                    maxlength="16"
                    required
                  />
                </div>
                <div class="col-md-8">
                  <label class="form-label">Nama Lengkap</label>
                  <input
                    type="text"
                    id="nama"
                    class="form-control"
                    placeholder="Nama almarhum/almarhumah"
                    required
                  />
                </div>
                <div class="col-md-12">
                  <label class="form-label">Alamat Lengkap</label>
                  <textarea
                    id="alamat_lengkap"
                    class="form-control"
                    rows="2"
                    required
                  ></textarea>
                </div>
                <div class="col-md-2">
                  <label class="form-label">Desa / Kelurahan</label>
                  <select class="form-select" id="desa">
                    <option value="">--Pilih--</option>
                    <option value="Ngantru">Ngantru</option>
                    <option value="Tamanan">Tamanan</option>
                    <option value="Sumber Gedong">Sumber Gedong</option>
                    <option value="Kelutan">Kelutan</option>
                    <option value="Sambirejo">Sambirejo</option>
                    <option value="Karangsoko">Karangsoko</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">Umur</label>
                  <input
                    type="number"
                    id="umur"
                    class="form-control"
                    min="0"
                    max="120"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <label class="form-label">Jenis Kelamin</label>
                  <select id="jk" class="form-select" required>
                    <option value="">-- Pilih --</option>
                    <option value="L">Laki-laki</option>
                    <option value="P">Perempuan</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Tanggal Meninggal</label>
                  <input
                    type="text"
                    id="tgl_meninggal"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Tempat Meninggal</label>
                  <input
                    type="text"
                    id="tempat_meninggal"
                    class="form-control"
                    placeholder="Misal: RSUD Trenggalek"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Diagnosa</label>
                  <input
                    type="text"
                    id="diagnosa"
                    class="form-control"
                    placeholder="Masukkan diagnosa penyebab kematian"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Kode ICD 10</label>
                  <input
                    type="text"
                    id="kode_icd_10"
                    class="form-control"
                    placeholder="Contoh: A41.9"
                  />
                </div>
              </div>

              <div class="mt-4 text-end">
                <button
                  type="submit"
                  class="btn btn-light fw-bold text-success shadow-sm"
                >
                  <i class="fa-solid fa-paper-plane me-1"></i>Simpan Data
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- === FORM KELAHIRAN === -->
        <div class="tab-pane fade" id="kelahiran">
          <div
            class="card"
            style="background: linear-gradient(135deg, #38bdf8, #60a5fa)"
          >
            <h5 class="mb-3 fw-semibold text-white">
              <i class="fa-solid fa-baby me-2"></i>Data Kelahiran
            </h5>

            <form id="formKelahiran">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">NIK Bayi</label>
                  <input
                    type="text"
                    id="nik_bayi"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Nama Bayi</label>
                  <input
                    type="text"
                    id="nama_bayi"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Nama Ibu</label>
                  <input
                    type="text"
                    id="nama_ibu"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Tanggal Lahir</label>
                  <input
                    type="text"
                    id="tgl_lahir"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Jenis Kelamin</label>
                  <select id="jk_bayi" class="form-select" required>
                    <option value="">-- Pilih --</option>
                    <option value="L">Laki-laki</option>
                    <option value="P">Perempuan</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Tempat Lahir</label>
                  <input
                    type="text"
                    id="tempat_lahir"
                    class="form-control"
                    placeholder="Misal: RSUD Trenggalek"
                    required
                  />
                </div>
              </div>

              <div class="mt-4 text-end">
                <button
                  type="submit"
                  class="btn btn-light fw-bold text-primary shadow-sm"
                >
                  <i class="fa-solid fa-paper-plane me-1"></i>Simpan Data
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer>Â© Sistem Data Penduduk Puskesmas Trenggalek | @yoga</footer>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Bootstrap & Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        flatpickr("#tgl_meninggal", { dateFormat: "Y-m-d" });
        flatpickr("#tgl_lahir", { dateFormat: "Y-m-d" });

        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbwONhP_0zc5u3ThodgvX1ebDWOZWOgcVvn8Uy09LioGJAZYSTjDoFXw8d1kOpZrQ2CF2A/exec";

        // === FORM KEMATIAN ===
        document
          .getElementById("formKematian")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Mengirim Data Kematian...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKematian",
              nik: nik.value,
              nama: nama.value,
              alamat_lengkap: alamat_lengkap.value,
              desa: desa.value,
              umur: umur.value,
              jk: jk.value,
              tgl_meninggal: tgl_meninggal.value,
              tempat_meninggal: tempat_meninggal.value,
              diagnosa: diagnosa.value,
              kode_icd_10: kode_icd_10.value,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload),
              });
              const data = await res.json();
              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kematian tersimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                formKematian.reset();
              } else throw new Error(data.message);
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });

        // === FORM KELAHIRAN ===
        document
          .getElementById("formKelahiran")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Mengirim Data Kelahiran...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKelahiran",
              nik_bayi: nik_bayi.value,
              nama_bayi: nama_bayi.value,
              nama_ibu: nama_ibu.value,
              tgl_lahir: tgl_lahir.value,
              jk: jk_bayi.value,
              tempat_lahir: tempat_lahir.value,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload),
              });
              const data = await res.json();
              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kelahiran tersimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                formKelahiran.reset();
              } else throw new Error(data.message);
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });
      });
    </script>
  </body>
</html>
