<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form Data Penduduk - Puskesmas</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Flatpickr -->
    <link
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(135deg, #dbeafe 0%, #f0fdfa 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        background: linear-gradient(135deg, #22c55e, #14b8a6);
        color: #fff;
        padding: 2rem;
      }
      .form-label {
        font-weight: 600;
        color: #374151;
      }
      input.form-control,
      select.form-select,
      textarea.form-control {
        border-radius: 12px;
        transition: all 0.2s;
      }
      input.form-control:focus,
      select.form-select:focus,
      textarea.form-control:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
      }
      .btn-primary,
      .btn-light {
        border-radius: 12px;
        padding: 0.55rem 1.5rem;
        font-weight: 600;
      }
      footer {
        margin-top: auto;
        text-align: center;
        padding: 1rem;
        color: #111827;
        font-size: 0.9rem;
      }
      .nav-pills .nav-link.active {
        background-color: #16a34a !important;
      }
      .nav-pills .nav-link {
        font-weight: 600;
        color: #0f172a;
      }
    </style>
  </head>

  <body>
    <div class="container py-5">
      <div class="mb-3 text-center">
        <img
          src="https://pkmtrenggalek.github.io/SIP/assets/pkm.png"
          alt="Logo Puskesmas Trenggalek"
          width="100"
          class="mb-3"
        />
        <!-- <h5 class="text-muted mb-4">Puskesmas Trenggalek</h5> -->
      </div>
      <h3 class="mb-4 text-center fw-bold">
        <i class="fa-solid fa-users me-2 text-success"></i>Form Data Penduduk
      </h3>
      <a
        href="laporan.html"
        class="btn btn-outline-success btn-sm px-4 shadow-sm"
      >
        Laporan
      </a>
      <!-- Tabs menu -->
      <ul class="nav nav-pills justify-content-center mb-4" id="dataTabs">
        <li class="nav-item">
          <button
            class="nav-link active"
            id="kematian-tab"
            data-bs-toggle="tab"
            data-bs-target="#kematian"
            type="button"
          >
            ðŸª¦ Input Data Kematian
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            id="kelahiran-tab"
            data-bs-toggle="tab"
            data-bs-target="#kelahiran"
            type="button"
          >
            ðŸ‘¶ Input Data Kelahiran
          </button>
        </li>
      </ul>

      <!-- Tab content -->
      <div class="tab-content">
        <!-- === FORM KEMATIAN (Tampilan Grid Rapi) === -->
        <div class="tab-pane fade show active" id="kematian">
          <div class="card p-4 shadow-sm border-0">
            <h5 class="mb-3 fw-semibold text-white bg-success p-2 rounded">
              <i class="fa-solid fa-tombstone me-2"></i>Data Kematian
            </h5>

            <form id="formKematian">
              <div class="container-fluid">
                <!-- NIK -->
                <div class="row mb-3 align-items-center">
                  <label for="nik" class="col-md-2 col-form-label fw-semibold"
                    >NIK *</label
                  >
                  <div class="col-md-4">
                    <input
                      type="text"
                      id="nik"
                      class="form-control"
                      maxlength="16"
                      required
                    />
                  </div>
                </div>

                <!-- Nama Lengkap -->
                <div class="row mb-3 align-items-center">
                  <label for="nama" class="col-md-2 col-form-label fw-semibold"
                    >Nama Lengkap *</label
                  >
                  <div class="col-md-6">
                    <input
                      type="text"
                      id="nama"
                      class="form-control"
                      placeholder="Nama almarhum/almarhumah"
                      required
                    />
                  </div>
                </div>

                <!-- Alamat -->
                <div class="row mb-3">
                  <label
                    for="alamat_lengkap"
                    class="col-md-2 col-form-label fw-semibold"
                    >Alamat Lengkap *</label
                  >
                  <div class="col-md-8">
                    <textarea
                      id="alamat_lengkap"
                      class="form-control"
                      rows="2"
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- Desa, Umur, Jenis Kelamin -->
                <div class="row mb-3">
                  <label class="col-md-2 col-form-label fw-semibold"
                    >Desa / Kelurahan *</label
                  >
                  <div class="col-md-2">
                    <select class="form-select" id="desa" required>
                      <option value="">--Pilih--</option>
                      <option value="Ngantru">Ngantru</option>
                      <option value="Tamanan">Tamanan</option>
                      <option value="Sumber Gedong">Sumber Gedong</option>
                      <option value="Kelutan">Kelutan</option>
                      <option value="Sambirejo">Sambirejo</option>
                      <option value="Karangsoko">Karangsoko</option>
                    </select>
                  </div>

                  <label class="col-md-1 col-form-label fw-semibold"
                    >Umur *</label
                  >
                  <div class="col-md-1">
                    <input
                      type="number"
                      id="umur"
                      class="form-control"
                      min="0"
                      max="120"
                      required
                    />
                  </div>

                  <label class="col-md-2 col-form-label fw-semibold"
                    >Jenis Kelamin *</label
                  >
                  <div class="col-md-2">
                    <select id="jk" class="form-select" required>
                      <option value="">-- Pilih --</option>
                      <option value="L">Laki-laki</option>
                      <option value="P">Perempuan</option>
                    </select>
                  </div>
                </div>

                <!-- Tanggal & Tempat Meninggal -->
                <div class="row mb-3">
                  <label class="col-md-2 col-form-label fw-semibold"
                    >Tanggal Meninggal *</label
                  >
                  <div class="col-md-3">
                    <input
                      type="date"
                      id="tgl_meninggal"
                      class="form-control"
                      required
                    />
                  </div>

                  <label class="col-md-2 col-form-label fw-semibold"
                    >Tempat Meninggal *</label
                  >
                  <div class="col-md-3">
                    <input
                      type="text"
                      id="tempat_meninggal"
                      class="form-control"
                      placeholder="Misal: RSUD Trenggalek"
                      required
                    />
                  </div>
                </div>

                <!-- Diagnosa -->
                <div class="row mb-3">
                  <label class="col-md-2 col-form-label fw-semibold"
                    >Penyebab Kematian *</label
                  >
                  <div class="col-md-8">
                    <textarea
                      id="diagnosa"
                      class="form-control"
                      rows="2"
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- Tombol Simpan -->
                <div class="row">
                  <div class="col-md-10 text-end">
                    <button
                      type="submit"
                      class="btn btn-success fw-bold shadow-sm px-4"
                    >
                      <i class="fa-solid fa-paper-plane me-1"></i> Simpan Data
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- === FORM KELAHIRAN (Tampilan Grid Rapi) === -->
        <!-- === FORM KELAHIRAN (Versi Rapi & Profesional) === -->
        <div class="tab-pane fade" id="kelahiran">
          <div
            class="card p-4 shadow-sm border-0"
            style="background: linear-gradient(135deg, #474745, #90be46be)"
          >
            <h5 class="mb-4 fw-semibold text-white border-bottom pb-2">
              <i class="fa-solid fa-baby me-2"></i>Data Kelahiran
            </h5>

            <form id="formKelahiran">
              <div class="container-fluid">
                <!-- NIK Bayi -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="nik_bayi"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    NIK Bayi
                  </label>
                  <div class="col-md-4">
                    <input
                      type="text"
                      id="nik_bayi"
                      class="form-control"
                      maxlength="16"
                      required
                    />
                  </div>
                </div>

                <!-- Nama Bayi -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="nama_bayi"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Nama Bayi
                  </label>
                  <div class="col-md-6">
                    <input
                      type="text"
                      id="nama_bayi"
                      class="form-control"
                      required
                    />
                  </div>
                </div>

                <!-- Jenis Kelamin -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="jk_bayi"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Jenis Kelamin
                  </label>
                  <div class="col-md-3">
                    <select id="jk_bayi" class="form-select" required>
                      <option value="">-- Pilih --</option>
                      <option value="L">Laki-laki</option>
                      <option value="P">Perempuan</option>
                    </select>
                  </div>
                </div>

                <!-- Nama Ayah -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="nama_ayah"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Nama Ayah
                  </label>
                  <div class="col-md-6">
                    <input
                      type="text"
                      id="nama_ayah"
                      class="form-control"
                      required
                    />
                  </div>
                </div>

                <!-- Nama Ibu -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="nama_ibu"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Nama Ibu
                  </label>
                  <div class="col-md-6">
                    <input
                      type="text"
                      id="nama_ibu"
                      class="form-control"
                      required
                    />
                  </div>
                </div>

                <!-- Alamat -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="alamat"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Alamat
                  </label>
                  <div class="col-md-6">
                    <textarea
                      id="alamat"
                      class="form-control"
                      rows="2"
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- RT / RW -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="RT"
                    class="col-md-2 col-form-label fw-semibold text-white"
                    >RT / RW</label
                  >
                  <div class="col-md-1">
                    <input
                      type="text"
                      id="RT"
                      class="form-control text-center"
                      required
                    />
                  </div>
                  <div class="col-md-1">
                    <input
                      type="text"
                      id="RW"
                      class="form-control text-center"
                      required
                    />
                  </div>
                </div>

                <!-- Desa / Kelurahan -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="desa"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Desa / Kelurahan
                  </label>
                  <div class="col-md-3">
                    <select class="form-select" id="desa" required>
                      <option value="">-- Pilih --</option>
                      <option value="Ngantru">Ngantru</option>
                      <option value="Tamanan">Tamanan</option>
                      <option value="Sumber Gedong">Sumber Gedong</option>
                      <option value="Kelutan">Kelutan</option>
                      <option value="Sambirejo">Sambirejo</option>
                      <option value="Karangsoko">Karangsoko</option>
                    </select>
                  </div>
                </div>

                <!-- Tanggal & Jam Lahir -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="tgl_lahir"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Tanggal / Jam Lahir
                  </label>
                  <div class="col-md-2">
                    <input
                      type="date"
                      id="tgl_lahir"
                      class="form-control"
                      required
                    />
                  </div>
                  <div class="col-md-2">
                    <input
                      type="time"
                      id="jam_lahir"
                      class="form-control"
                      required
                    />
                  </div>
                </div>

                <!-- Jenis Persalinan -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="jenis"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Jenis Persalinan
                  </label>
                  <div class="col-md-4">
                    <select class="form-select" id="jenis" required>
                      <option value="">-- Pilih --</option>
                      <option value="Normal">Normal</option>
                      <option value="Spontan">Spontan</option>
                      <option value="SC">SC</option>
                      <option value="Drip">Drip</option>
                      <option value="Vacum">Vacum</option>
                    </select>
                  </div>
                </div>

                <!-- Tempat Lahir -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="tempat_lahir"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Tempat Lahir
                  </label>
                  <div class="col-md-4">
                    <select class="form-select" id="tempat_lahir" required>
                      <option value="">-- Pilih --</option>
                      <option value="POLINDES">POLINDES</option>
                      <option value="BPM">BPM</option>
                      <option value="Puskesmas">Puskesmas</option>
                      <option value="PONED">PONED</option>
                      <option value="RSUD">RSUD</option>
                      <option value="BPS">BPS</option>
                      <option value="Lainnya">Lainnya</option>
                    </select>
                  </div>
                </div>

                <!-- Penolong Kelahiran -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="penolong"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Penolong Kelahiran
                  </label>
                  <div class="col-md-4">
                    <select class="form-select" id="penolong" required>
                      <option value="">-- Pilih --</option>
                      <option value="Bidan">Bidan</option>
                      <option value="SPOG">SPOG</option>
                      <option value="Lainnya">Lainnya</option>
                    </select>
                  </div>
                </div>

                <!-- Jenis Pendanaan, BB, TB -->
                <div class="row mb-3 align-items-center">
                  <label
                    for="jenis_pendanaan"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Jenis Pendanaan
                  </label>
                  <div class="col-md-2">
                    <select class="form-select" id="jenis_pendanaan" required>
                      <option value="">-- Pilih --</option>
                      <option value="KIS">KIS</option>
                      <option value="BPJS">BPJS</option>
                      <option value="Bayar">Bayar</option>
                      <option value="Jampersal">Jampersal</option>
                      <option value="Lainnya">Lainnya</option>
                    </select>
                  </div>

                  <label
                    for="BB"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Berat Badan (kg)
                  </label>
                  <div class="col-md-1">
                    <input
                      type="number"
                      step="0.1"
                      id="BB"
                      class="form-control text-center"
                    />
                  </div>

                  <label
                    for="TB"
                    class="col-md-2 col-form-label fw-semibold text-white"
                  >
                    Tinggi Badan (cm)
                  </label>
                  <div class="col-md-1">
                    <input
                      type="number"
                      step="0.1"
                      id="TB"
                      class="form-control text-center"
                    />
                  </div>
                </div>

                <!-- Tombol Simpan -->
                <div class="row mt-4">
                  <div class="col-md-10 text-end">
                    <button
                      type="submit"
                      class="btn btn-light fw-bold text-success shadow-sm px-4"
                    >
                      <i class="fa-solid fa-paper-plane me-1"></i> Simpan Data
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <footer>Â© Sistem Data Penduduk Puskesmas Trenggalek | @yoga</footer>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Bootstrap & Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // === Flatpickr setup ===
        flatpickr("#tgl_meninggal", { dateFormat: "Y-m-d" });
        flatpickr("#tgl_lahir", { dateFormat: "Y-m-d" });

        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbwyu-78yUjES6fnZyi6nClaRjOmmqkUxhY9ZXsz9Xsa1D6pYkymHl6U1QfUXMnD7_dvwA/exec";

        // === FORM KEMATIAN ===
        document
          .getElementById("formKematian")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Mengirim Data Kematian...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKematian",
              nik: nik.value,
              nama: nama.value,
              alamat_lengkap: alamat_lengkap.value,
              desa: desa.value,
              umur: umur.value,
              jk: jk.value,
              tgl_meninggal: tgl_meninggal.value,
              tempat_meninggal: tempat_meninggal.value,
              diagnosa: diagnosa.value,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload), // tanpa headers agar tidak preflight
              });
              const data = await res.json();
              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kematian tersimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                formKematian.reset();
              } else throw new Error(data.message);
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });

        // === FORM KELAHIRAN ===
        document
          .getElementById("formKelahiran")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const nik_bayi = document.getElementById("nik_bayi").value.trim();
            const nama_bayi = document.getElementById("nama_bayi").value.trim();
            const jk_bayi = document.getElementById("jk_bayi").value;
            const nama_ayah = document.getElementById("nama_ayah").value.trim();
            const nama_ibu = document.getElementById("nama_ibu").value.trim();
            const alamat = document.getElementById("alamat").value.trim();
            const RT = document.getElementById("RT").value.trim();
            const RW = document.getElementById("RW").value.trim();
            const desa = document.getElementById("desa").value;
            const tgl_lahir = document.getElementById("tgl_lahir").value;
            const jam_lahir = document.getElementById("jam_lahir").value.trim();
            const jenis = document.getElementById("jenis").value;
            const tempat_lahir = document.getElementById("tempat_lahir").value;
            const penolong =
              document.querySelector("select#penolong")?.value || "";
            const jenis_pendanaan =
              document.querySelector("select#jenis_pendanaan")?.value || "";
            const BB = document.getElementById("BB").value.trim();
            const TB = document.getElementById("TB").value.trim();

            if (!nik_bayi || !nama_bayi || !tgl_lahir || !jk_bayi) {
              Swal.fire(
                "Lengkapi Data!",
                "Beberapa field penting masih kosong.",
                "warning"
              );
              return;
            }

            Swal.fire({
              title: "Mengirim Data Kelahiran...",
              allowOutsideClick: false,
              didOpen: () => Swal.showLoading(),
            });

            const payload = {
              action: "addKelahiran",
              nik_bayi,
              nama_bayi,
              jk_bayi,
              nama_ayah,
              nama_ibu,
              alamat,
              RT,
              RW,
              desa,
              tgl_lahir,
              jam_lahir,
              jenis,
              tempat_lahir,
              penolong,
              jenis_pendanaan,
              BB,
              TB,
            };

            try {
              const res = await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload),
              });
              const data = await res.json();

              if (data.status === "success") {
                Swal.fire({
                  icon: "success",
                  title: "Berhasil!",
                  text: "Data kelahiran berhasil disimpan.",
                  timer: 2000,
                  showConfirmButton: false,
                });
                e.target.reset();
              } else throw new Error(data.message || "Gagal menyimpan data!");
            } catch (err) {
              Swal.fire("Error", err.message, "error");
            }
          });
      });
    </script>
  </body>
</html>
